{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "LOCK-3 Observer Event Schema v1.0",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "event_id",
    "ts",
    "judgment_id",
    "approval_record_id",
    "execution_run_id",
    "status",
    "metrics",
    "prev_hash",
    "hash"
  ],
  "properties": {
    "schema_version": { "type": "string", "const": "lock3/observer_event@1.0" },
    "event_id": { "type": "string", "minLength": 8, "maxLength": 128 },
    "ts": { "type": "string", "minLength": 10, "maxLength": 40 },
    "judgment_id": { "type": "string", "minLength": 3, "maxLength": 128 },
    "approval_record_id": { "type": "string", "minLength": 3, "maxLength": 128 },
    "execution_run_id": { "type": "string", "minLength": 3, "maxLength": 128 },
    "status": {
      "type": "string",
      "enum": ["started", "ok", "fail", "aborted"]
    },
    "metrics": {
      "type": "object",
      "additionalProperties": false,
      "required": [],
      "properties": {
        "latency_ms": { "type": "integer", "minimum": 0 },
        "risk_flags": {
          "type": "array",
          "items": { "type": "string", "minLength": 1, "maxLength": 64 },
          "maxItems": 64
        },
        "notes": { "type": "string", "maxLength": 500 }
      }
    },
    "prev_hash": { "type": "string", "pattern": "^[0-9a-f]{64}$" },
    "hash": { "type": "string", "pattern": "^[0-9a-f]{64}$" }
  }
}
