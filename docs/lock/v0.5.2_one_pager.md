# LOCK v0.5.2 — Constitutional API Bound (Transition / No-Bypass)

**Repository:** proto-v2-engine  
**Tag:** v0.5.2  
**Date:** 2026-01-16 (Australia/Sydney)

---

## What is LOCKED

### A) Constitutional Transition is a single, auditable gate
- Public API endpoint exists:
  - `POST /v1/constitutional/transition`
- Execution is allowed only through:
  - **Judgment approval (immutable)**
  - **Human decision present for APPROVE (no bypass)**
  - **DPA apply gate enforced (idempotent APPLIED)**

### B) No-bypass invariants
- If `approval.decision == "APPROVE"` **and** `human_decision is None`:
  - return **403** with `Missing human_decision (no bypass)`
- If `approval.decision == "REJECT"`:
  - return **403** with `Rejected (immutable)`

### C) DPA apply gate error transparency
- If apply is blocked by policy/transition errors:
  - returned as `PermissionError` detail preserving `(code/message/extra)` best-effort
  - without hard-coupling to judgment error types

---

## Endpoints

### 1) Transition (LOCKED)
- `POST /v1/constitutional/transition`
- Purpose: Constitutional gate → DPA apply gate → engine evaluation

### 2) Debug seed (DEV-only, gated by env)
- `POST /v1/constitutional/__debug_seed`
- Enabled only when:
  - `METAOS_ENV in ("dev","local")`
- Otherwise:
  - returns **404** `DEBUG_SEED_DISABLED`

---

## Smoke / Verification

### Primary smoke
- Script: `./scripts/smoke_v0.5.sh`
- Must pass:
  1) `pytest` suites
  2) server boot
  3) openapi includes `/v1/constitutional/transition`
  4) approve flow passes (seed → transition)
  5) reject flow blocks (403)

Expected final line:
- `[DONE] smoke_v0.5 OK`

---

## Locked Files (core surfaces)

- `core/engine/constitutional_transition.py`
  - apply-gate enforced, idempotent APPLIED semantics, no bypass
- `infra/api/routes/constitutional.py`
  - transition endpoint
  - debug seed endpoint (env gated)
- `infra/api/app.py`
  - router included
- `scripts/smoke_v0.5.sh`
  - reproducible E2E smoke for v0.5.x

---

## Out of Scope (NOT locked)
- Persistence backend (repo storage beyond in-memory)
- Production auth/rbac layer
- Domain-specific composers/plugins (beyond minimal composer)
- Approval queue externalization
