{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "domain_event.v1",
  "type": "object",
  "required": [
    "schema",
    "domain",
    "kind",
    "event_id",
    "ts_iso",
    "signal",
    "meta"
  ],
  "properties": {
    "schema": {
      "const": "domain_event.v1"
    },
    "domain": {
      "type": "string",
      "pattern": "^[a-z0-9_\\-]+$"
    },
    "kind": {
      "type": "string",
      "enum": ["SIGNAL", "EMIT", "OBSERVATION"]
    },
    "event_id": {
      "type": "string",
      "minLength": 1
    },
    "ts_iso": {
      "type": "string",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$"
    },
    "signal": {
      "type": "object",
      "required": [
        "type",
        "symbol",
        "timeframe",
        "score",
        "confidence",
        "risk_level"
      ],
      "properties": {
        "type": {
          "type": "string",
          "pattern": "^[A-Z0-9_\\-]+$"
        },
        "symbol": {
          "type": "string",
          "minLength": 1,
          "maxLength": 64
        },
        "timeframe": {
          "type": "string",
          "enum": ["1m", "5m", "15m", "1h", "4h", "1d", "other"]
        },
        "score": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "risk_level": {
          "type": "string",
          "enum": ["low", "medium", "high"]
        },
        "direction": {
          "type": "string",
          "enum": ["long", "short", "neutral"]
        },
        "tags": {
          "type": "array",
          "maxItems": 32,
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 64
          }
        },
        "metrics": {
          "type": "object",
          "additionalProperties": true,
          "maxProperties": 64
        }
      },
      "additionalProperties": false
    },
    "meta": {
      "type": "object",
      "required": ["producer", "version", "build_sha"],
      "properties": {
        "producer": {
          "type": "string"
        },
        "version": {
          "type": "string"
        },
        "build_sha": {
          "type": "string",
          "pattern": "^[a-fA-F0-9]{7,64}$"
        },
        "session_id": {
          "type": "string"
        },
        "device_id": {
          "type": "string"
        },
        "trace_id": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "evidence_refs": {
      "type": "array",
      "maxItems": 32,
      "items": {
        "type": "object",
        "required": ["ref_kind", "ref"],
        "properties": {
          "ref_kind": {
            "type": "string",
            "enum": ["AUDIT_RECORD_HASH", "OBSERVER_EVENT_ID", "FILEPATH", "URL"]
          },
          "ref": {
            "type": "string",
            "maxLength": 512
          }
        },
        "additionalProperties": false
      }
    }
  },
  "additionalProperties": false
}
