# gatekit_template: lock-f4-submodule-hygiene-v1
name: Submodule Hygiene Gate

on:
  pull_request:
  push:
    branches: [ main ]

jobs:
  submodule-hygiene-gate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main repo (no submodules)
        uses: actions/checkout@v4
        with:
          submodules: false
          persist-credentials: false

      - name: Clone submodules using PAT
        env:
          SUBMODULES_PAT: ${{ secrets.SUBMODULES_PAT }}
        run: |
          if [ -z "$SUBMODULES_PAT" ]; then
            echo "‚ùå SUBMODULES_PAT secret is missing"
            exit 1
          fi

          git config --global url."https://${SUBMODULES_PAT}@github.com/".insteadOf "https://github.com/"
          git submodule sync --recursive
          git submodule update --init --recursive --depth=1

      - name: Submodule hygiene check
        run: |
          echo "Submodules cloned successfully."
